<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Markmap</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      #mindmap {
        display: block;
        width: 100vw;
        height: 100vh;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-beta.4/dist/style.css"
    />
  </head>
  <body>
    <svg id="mindmap"></svg>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.3-beta.4/dist/browser/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.3-beta.4/dist/index.js"></script>
    <script>
      (() => {
        setTimeout(() => {
          const { markmap: k, mm: N } = window,
            U = new k.Toolbar();
          U.attach(N);
          const D = U.render();
          D.setAttribute('style', 'position:absolute;bottom:20px;right:20px'),
            document.body.append(D);
        });
      })();
    </script>
    <script>
      ((n, M, H, F) => {
        const G = n();
        window.mm = G.Markmap.create(
          'svg#mindmap',
          (M || G.deriveOptions)(F),
          H
        );
      })(
        () => window.markmap,
        null,
        {
          content:
            '2. Recuperación y Restauración de Bases de Datos Distribuidas',
          children: [
            {
              content: '2.1. Problema',
              children: [
                {
                  content:
                    '<strong>Transacción</strong>: Unidad de programa cuya ejecución conserva la consistencia de una base de datos.',
                  children: [
                    {
                      content:
                        'La ejecución concurrente de transacciones tiene el mismo efecto que si se ejecutara sola.',
                      children: [],
                      payload: { lines: '8,9' },
                    },
                    {
                      content: '<strong>Transacción atómica</strong>:',
                      children: [
                        {
                          content:
                            'Difícil de garantizar en bases de datos distribuidas.',
                          children: [],
                          payload: { lines: '10,11' },
                        },
                        {
                          content:
                            'La garantiza el <strong>gestor de transacciones</strong>:',
                          children: [
                            {
                              content: 'Cada localidad tiene un gestor local.',
                              children: [],
                              payload: { lines: '12,13' },
                            },
                            {
                              content:
                                'Los gestores cooperan para ejecutar transacciones globales.',
                              children: [],
                              payload: { lines: '13,15' },
                            },
                          ],
                          payload: { lines: '11,15' },
                        },
                      ],
                      payload: { lines: '9,15' },
                    },
                  ],
                  payload: { lines: '7,15' },
                },
              ],
              payload: { lines: '5,6' },
            },
            {
              content: '2.2. Estructura del Sistema',
              children: [
                {
                  content:
                    '1. \n<p data-lines="19,20"><strong>Coordinador de Transacciones</strong> (de cada localidad):</p>',
                  children: [
                    {
                      content: 'Inicia la ejecución de la transacción.',
                      children: [],
                      payload: { lines: '20,21' },
                    },
                    {
                      content: 'Divide la transacción en subtransacciones.',
                      children: [],
                      payload: { lines: '21,22' },
                    },
                    {
                      content:
                        'Distribuye las subtransacciones entre localidades.',
                      children: [],
                      payload: { lines: '22,23' },
                    },
                    {
                      content: 'Coordina la terminación.',
                      children: [],
                      payload: { lines: '23,25' },
                    },
                  ],
                  payload: { lines: '19,25', listIndex: 1 },
                },
                {
                  content:
                    '2. \n<p data-lines="25,26"><strong>Gestor de Transacciones</strong> (de cada localidad):</p>',
                  children: [
                    {
                      content: 'Mantiene una bitácora para recuperación.',
                      children: [],
                      payload: { lines: '26,27' },
                    },
                    {
                      content:
                        'Coordina la ejecución en paralelo de las transacciones en su localidad.',
                      children: [],
                      payload: { lines: '27,29' },
                    },
                  ],
                  payload: { lines: '25,29', listIndex: 2 },
                },
              ],
              payload: { lines: '17,18' },
            },
            {
              content: '2.3. Consistencia',
              children: [
                {
                  content: '',
                  children: [
                    {
                      content: 'Fallo total.',
                      children: [],
                      payload: { lines: '35,36' },
                    },
                    {
                      content: 'Interrupción de comunicación.',
                      children: [],
                      payload: { lines: '36,37' },
                    },
                    {
                      content: 'Pérdida de mensajes.',
                      children: [],
                      payload: { lines: '37,38' },
                    },
                    {
                      content: 'Fragmentación de la red.',
                      children: [],
                      payload: { lines: '38,40' },
                    },
                  ],
                  payload: { lines: '35,40' },
                },
                {
                  content: '',
                  children: [
                    {
                      content: 'Detectar el fallo.',
                      children: [],
                      payload: { lines: '42,43' },
                    },
                    {
                      content: 'Reconfigurar el sistema.',
                      children: [],
                      payload: { lines: '43,44' },
                    },
                    {
                      content: 'Recuperarlo.',
                      children: [],
                      payload: { lines: '44,46' },
                    },
                  ],
                  payload: { lines: '42,46' },
                },
              ],
              payload: { lines: '31,32' },
            },
            {
              content: '2.3.1. Procedimiento de Reconfiguración',
              children: [
                {
                  content:
                    '1. \n<p data-lines="50,51">Se detecta un fallo en una localidad (L_1):</p>',
                  children: [
                    {
                      content: 'Si se almacena información repetida en (L_1):',
                      children: [
                        {
                          content:
                            'Actualizar el catálogo para no referenciar la copia de (L_1).',
                          children: [],
                          payload: { lines: '52,53' },
                        },
                      ],
                      payload: { lines: '51,53' },
                    },
                    {
                      content: 'Abortar las transacciones activas en (L_1).',
                      children: [],
                      payload: { lines: '53,54' },
                    },
                    {
                      content:
                        'Si (L_1) es el distribuidor central de algún subsistema, elegir un nuevo distribuidor.',
                      children: [],
                      payload: { lines: '54,56' },
                    },
                  ],
                  payload: { lines: '50,56', listIndex: 1 },
                },
                {
                  content: '2. \n<p data-lines="56,57">Consideraciones:</p>',
                  children: [
                    {
                      content:
                        'Evitar elegir múltiples distribuidores centrales en distintos fragmentos.',
                      children: [],
                      payload: { lines: '57,58' },
                    },
                    {
                      content:
                        'Evitar actualizar un dato repetido en más de un fragmento.',
                      children: [],
                      payload: { lines: '58,60' },
                    },
                  ],
                  payload: { lines: '56,60', listIndex: 2 },
                },
              ],
              payload: { lines: '48,49' },
            },
            {
              content: '2.3.2. Procedimiento de Recuperación',
              children: [
                {
                  content:
                    '1. \n<p data-lines="64,65"><strong>Cuando (L_1) se recupera</strong>:</p>',
                  children: [
                    {
                      content:
                        'Se inicia el procedimiento de actualización de sus tablas del sistema.',
                      children: [],
                      payload: { lines: '65,66' },
                    },
                    {
                      content: 'Si (L_1) tenía copia de datos:',
                      children: [
                        {
                          content: 'Obtener los valores actuales.',
                          children: [],
                          payload: { lines: '67,68' },
                        },
                        {
                          content:
                            'Asegurar que (L_1) reciba futuras actualizaciones.',
                          children: [],
                          payload: { lines: '68,70' },
                        },
                      ],
                      payload: { lines: '66,70' },
                    },
                  ],
                  payload: { lines: '64,70', listIndex: 1 },
                },
                {
                  content:
                    '2. \n<p data-lines="70,71"><strong>Durante la recuperación</strong>:</p>',
                  children: [
                    {
                      content: 'Mientras se actualizan los datos:',
                      children: [
                        {
                          content:
                            '<strong>Solución 1</strong>: Suspender temporalmente las operaciones (inaceptable para las aplicaciones).',
                          children: [],
                          payload: { lines: '72,73' },
                        },
                        {
                          content:
                            '<strong>Solución 2</strong>: Representar tareas de recuperación como transacciones, para que el subsistema de control de concurrencia reintegre (L_1).',
                          children: [],
                          payload: { lines: '73,75' },
                        },
                      ],
                      payload: { lines: '71,75' },
                    },
                  ],
                  payload: { lines: '70,75', listIndex: 2 },
                },
                {
                  content:
                    '3. \n<p data-lines="75,76"><strong>Cuando se recupera la línea de comunicación</strong>:</p>',
                  children: [
                    {
                      content:
                        'Se envía un mensaje a las localidades informando la recuperación.',
                      children: [],
                      payload: { lines: '76,78' },
                    },
                  ],
                  payload: { lines: '75,78', listIndex: 3 },
                },
              ],
              payload: { lines: '62,63' },
            },
          ],
          payload: { lines: '1,2' },
        },
        { colorFreezeLevel: 2 }
      );
    </script>
    <script>
      (() => {
        const { markmap: Markmap } = window;
        const svg = document.querySelector('#mindmap');
        const markmapInstance = Markmap.create(svg, null, {
          content: 'Contenido de tu mindmap aquí',
        });

        // Añadir zoom y pan
        const zoom = d3
          .zoom()
          .scaleExtent([0.5, 5]) // Limita el zoom (mínimo 0.5x y máximo 5x)
          .on('zoom', (event) => {
            svg.setAttribute('transform', event.transform);
          });

        d3.select(svg).call(zoom);
      })();
    </script>
  </body>
</html>
